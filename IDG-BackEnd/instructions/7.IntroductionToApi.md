# Introduction to API Setup (Laravel Sanctum)

This guide walks you through setting up API authentication using Laravel Sanctum.

## 1. Install API dependencies

```
php artisan install:api
composer require laravel/sanctum
```

## 2. Publish Sanctum configuration

```
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
```

## 3. Run database migrations

```
php artisan migrate
```

## 4. Update User model

Add the `HasApiTokens` trait to the `User` model (`app/Models/User.php`):

```
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, Notifiable;
    // ...existing code...
}
```

## 5. Create API Auth Controller

Generate a new controller for API authentication:

```
php artisan make:controller Api/AuthController
```

This will create `app/Http/Controllers/Api/AuthController.php` for your API authentication logic.

## 6: AuthController Implementation

```php
<?php

namespace App\Http\Controllers\API;

use App\Models\User;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use Illuminate\Support\Facades\Hash;

class AuthController extends Controller
{
    function signup(Request $request)
    {
        $fields = $request->validate([
            'name' => 'required|string',
            'email' => 'required|string|unique:users,email',
            'password' => 'required|string|confirmed'
        ]);

        $user = User::create($fields);

        $token = $user->createToken('AUTH-TOKEN');

        return response([
            'message' => 'signed up',
            'user' => $user,
            'token' => $token->plainTextToken
        ], 201);
    }

    function signin(Request $request)
    {
        $request->validate([
            'email' => 'required|email',
            'password' => 'required|string'
        ]);

        $user = User::where('email', $request->email)->first();
        
        if (!$user || !Hash::check($request->password, $user->password)) {
            return response([
                'message' => 'invalid credentials'
            ], 401);
        }

        $token = $user->createToken('AUTH-TOKEN');

        $response = [
            'message' => 'signed in',
            'user' => $user,
            'token' => $token->plainTextToken
        ];

        return response($response, 201);
    }

    function signout(Request $request)
    {
        $user = $request->user();
        $user->currentAccessToken()->delete();
        return [
            'message' => 'signed out'
        ];
    }
}
```

## API Routes Implementation

Add the following routes to `routes/api.php` to enable authentication endpoints:

```php
Route::post('/signup', [AuthController::class, 'signup']); // Register a new user and return token
Route::post('/signin', [AuthController::class, 'signin']); // Authenticate user and return token
Route::post('/signout', [AuthController::class, 'signout'])->middleware('auth:sanctum'); // Invalidate current token (logout)
```

**Route explanations:**
- `POST /signup`: Registers a new user. Requires `name`, `email`, `password`, and `password_confirmation` fields. Returns user info and an API token.
- `POST /signin`: Authenticates an existing user. Requires `email` and `password`. Returns user info and an API token.
- `POST /signout`: Logs out the authenticated user by revoking the current token. Requires authentication via Sanctum (`auth:sanctum` middleware).